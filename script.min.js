const MOBILE_BREAKPOINT=768,hamburger=document.querySelector(".hamburger"),navMenu=document.querySelector(".nav-menu"),cartSidebar=document.getElementById("cartSidebar");function isMobileViewport(){return window.matchMedia("(max-width: 768px)").matches}function syncUiOverlayState(){const e=Boolean(navMenu?.classList.contains("active")),t=Boolean(cartSidebar?.classList.contains("open"));document.body.classList.toggle("ui-locked",isMobileViewport()&&(e||t))}function closeMobileMenu(){navMenu?.classList.remove("active"),hamburger?.classList.remove("active"),syncUiOverlayState()}function setCartOpenState(e){cartSidebar&&(cartSidebar.classList.toggle("open",Boolean(e)),syncUiOverlayState())}function closeCart(){setCartOpenState(!1)}const THEME_STORAGE_KEY="zm_theme",LIGHT_THEME="light",DARK_THEME="dark",THEME_MEDIA_QUERY=window.matchMedia("(prefers-color-scheme: dark)"),PROD_API_BASE_URL="https://api.zarpadomueble.com",LOCAL_API_BASE_URL="http://localhost:3000";function resolveApiBaseUrl(){if("undefined"==typeof window||!window.location)return PROD_API_BASE_URL;const e=String(window.location.hostname||"").toLowerCase();return"localhost"===e||"127.0.0.1"===e||"[::1]"===e?LOCAL_API_BASE_URL:PROD_API_BASE_URL}const API_BASE_URL=resolveApiBaseUrl(),RECAPTCHA_V2_SITE_KEY="6LdtDG4sAAAAAMAXYM3oDCZhrM7qP7hsA85KABMM",RECAPTCHA_V2_SCRIPT_URL="https://www.google.com/recaptcha/api.js?render=explicit";let recaptchaScriptLoadPromise=null;const recaptchaWidgetIds={};function buildApiUrl(e){const t=String(e||"").trim();if(!t)return API_BASE_URL;if(/^https?:\/\//i.test(t))return t;const a=t.startsWith("/")?t:`/${t}`;return`${API_BASE_URL}${a}`}function getStoredTheme(){try{const e=localStorage.getItem("zm_theme");if("light"===e||"dark"===e)return e}catch(e){}return""}function getSystemTheme(){return THEME_MEDIA_QUERY.matches?"dark":"light"}function getInitialTheme(){return getStoredTheme()||getSystemTheme()}function updateThemeToggleUi(e){document.querySelectorAll(".js-theme-toggle").forEach(t=>{const a="dark"===e;t.setAttribute("aria-pressed",String(a)),t.setAttribute("aria-label",a?"Cambiar a tema claro":"Cambiar a tema oscuro"),t.dataset.theme=e;const i=t.querySelector("i");i&&(i.className=a?"fas fa-sun":"fas fa-moon");const n=t.querySelector(".theme-toggle-text");n&&(n.textContent=a?"Tema claro":"Tema oscuro")})}function updateThemeAwareAssets(e){const t="dark"===e;document.querySelectorAll("img[data-logo-light][data-logo-dark]").forEach(e=>{const a=t?e.dataset.logoDark:e.dataset.logoLight;a&&e.getAttribute("src")!==a&&e.setAttribute("src",a)})}function applyTheme(e,t=!1){const a="light"===e?"light":"dark";if(document.documentElement.setAttribute("data-theme",a),document.documentElement.style.colorScheme=a,updateThemeToggleUi(a),updateThemeAwareAssets(a),t)try{localStorage.setItem("zm_theme",a)}catch(e){}}function createThemeToggleButton(e=""){const t=document.createElement("button");return t.type="button",t.className=`theme-toggle js-theme-toggle ${e}`.trim(),t.innerHTML='<i class="fas fa-moon" aria-hidden="true"></i><span class="theme-toggle-text">Tema oscuro</span>',t}function ensureThemeToggleUi(){const e=document.querySelector(".nav-icons");e&&!e.querySelector(".js-theme-toggle")&&e.appendChild(createThemeToggleButton("theme-toggle-header"))}function initThemeToggle(){ensureThemeToggleUi(),applyTheme(getInitialTheme()),document.querySelectorAll(".js-theme-toggle").forEach(e=>{e.addEventListener("click",()=>{applyTheme("dark"===(document.documentElement.getAttribute("data-theme")||"dark")?"light":"dark",!0)})});"function"==typeof THEME_MEDIA_QUERY.addEventListener&&THEME_MEDIA_QUERY.addEventListener("change",()=>{getStoredTheme()||applyTheme(getSystemTheme())})}function setupAccessibleTriggers(){[{element:document.querySelector(".cart-icon"),label:"Abrir carrito"},{element:document.querySelector(".hamburger"),label:"Abrir menu"}].forEach(({element:e,label:t})=>{e&&(e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-label",t),e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())}))});const e=document.querySelector(".cart-count");e&&e.setAttribute("aria-live","polite")}"undefined"!=typeof window&&(window.ZM_API_BASE_URL=API_BASE_URL,window.zmBuildApiUrl=buildApiUrl),hamburger&&navMenu&&hamburger.addEventListener("click",()=>{const e=!navMenu.classList.contains("active");navMenu.classList.toggle("active",e),hamburger.classList.toggle("active",e),e&&closeCart(),syncUiOverlayState()}),document.querySelectorAll(".nav-link, .btn-nav").forEach(e=>e.addEventListener("click",()=>{closeMobileMenu()})),window.addEventListener("resize",()=>{window.innerWidth>768?closeMobileMenu():syncUiOverlayState()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(closeMobileMenu(),closeCart())}),document.addEventListener("click",e=>{const t=e.target;if(t instanceof Element&&navMenu?.classList.contains("active")){const e=navMenu.contains(t),a=hamburger?.contains(t);e||a||closeMobileMenu()}});const observerOptions={threshold:.15,rootMargin:"0px 0px -50px 0px"};let revealObserver=null;const shouldDisableRevealAnimations="undefined"!=typeof window&&window.matchMedia("(max-width: 768px), (prefers-reduced-motion: reduce)").matches;function observeRevealElement(e){e&&(revealObserver?revealObserver.observe(e):e.classList.add("active"))}!shouldDisableRevealAnimations&&"undefined"!=typeof window&&"IntersectionObserver"in window&&(revealObserver=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("active"),revealObserver.unobserve(e.target))})},observerOptions)),document.querySelectorAll(".reveal").forEach(observeRevealElement),document.querySelectorAll(".reveal-up").forEach(observeRevealElement);const FALLBACK_STORE_PRODUCTS=[{id:1,name:"Escritorio Gamer Pro",specs:"Melamina 18mm, pasacables y led frontal",price:185e3,image:"assets/desk_gamer.png",category:"Escritorios",stock:4,fulfillmentModel:"stock",availabilityMessage:"En stock - Envio en 48/72 hs",shippingEstimate:"48/72 hs",action:"cart"},{id:2,name:"Rack TV Minimalista",specs:'Para TV 65", cajones push-open',price:21e4,image:"assets/tv_rack.png",category:"Living",stock:3,fulfillmentModel:"stock",availabilityMessage:"En stock - Envio en 48/72 hs",shippingEstimate:"48/72 hs",action:"cart"},{id:3,name:"Mesa Ratona Industrial",specs:"Estructura de hierro y tapa paraíso",price:95e3,image:"assets/coffee_table.png",category:"Living",stock:8,fulfillmentModel:"stock",availabilityMessage:"En stock - Envio en 48/72 hs",shippingEstimate:"48/72 hs",action:"cart"},{id:4,name:"Biblioteca Moderna",specs:"Estantería asimétrica en melamina",price:145e3,image:"assets/library.png",category:"Living",stock:0,fulfillmentModel:"made_to_order",availabilityMessage:"Fabricacion bajo pedido - Entrega estimada: 10 a 20 dias habiles",shippingEstimate:"10 a 20 dias habiles",action:"cart"},{id:5,name:"Vajillero Nórdico",specs:"Módulo de guardado para cocina/comedor",price:23e4,image:"assets/sideboard.png",category:"Cocinas",stock:0,fulfillmentModel:"made_to_order",availabilityMessage:"Fabricacion bajo pedido - Entrega estimada: 10 a 20 dias habiles",shippingEstimate:"10 a 20 dias habiles",action:"cart"},{id:6,name:"Escritorio Home Office",specs:"Diseño compacto con cajonera móvil",price:12e4,image:"assets/office_desk.png",category:"Escritorios",stock:6,fulfillmentModel:"stock",availabilityMessage:"En stock - Envio en 48/72 hs",shippingEstimate:"48/72 hs",action:"cart"},{id:7,name:"Gabinete Multiuso",specs:"Guardado versátil para dormitorio o vestidor",price:18e4,image:"assets/cabinet.webp",category:"Placards",stock:0,fulfillmentModel:"made_to_order",availabilityMessage:"Fabricacion bajo pedido - Entrega estimada: 10 a 20 dias habiles",shippingEstimate:"10 a 20 dias habiles",action:"cart"},{id:8,name:"Silla de Diseño",specs:"Ergonómica con estructura reforzada",price:85e3,image:"assets/chair.webp",category:"Comedor",stock:12,fulfillmentModel:"stock",availabilityMessage:"En stock - Envio en 48/72 hs",shippingEstimate:"48/72 hs",action:"cart"},{id:9,name:"Mesa Comedor",specs:"Para 6 personas, tapa resistente",price:25e4,image:"assets/table.webp",category:"Comedor",stock:0,fulfillmentModel:"made_to_order",availabilityMessage:"Fabricacion bajo pedido - Entrega estimada: 10 a 20 dias habiles",shippingEstimate:"10 a 20 dias habiles",action:"cart"},{id:10,name:"Mueble TV Flotante",specs:"Diseño aéreo con pasacables oculto",price:2e5,image:"assets/tv_unit.webp",category:"Living",stock:0,fulfillmentModel:"made_to_order",availabilityMessage:"Fabricacion bajo pedido - Entrega estimada: 10 a 20 dias habiles",shippingEstimate:"10 a 20 dias habiles",action:"cart"},{id:11,name:"Escritorio Melamina",specs:"Formato clásico para estudio",price:13e4,image:"assets/melamine_desk.webp",category:"Escritorios",stock:7,fulfillmentModel:"stock",availabilityMessage:"En stock - Envio en 48/72 hs",shippingEstimate:"48/72 hs",action:"cart"}],QUOTE_PRODUCTS=[{id:12,name:"Cocina Integral",specs:"Diseño y fabricación a medida",price:0,image:"assets/kitchen.webp",action:"quote"},{id:13,name:"Placard Vestidor",specs:"Interior completo / Puertas corredizas",price:0,image:"assets/closet.webp",action:"quote"},{id:14,name:"Proyecto Living",specs:"Ambientación completa",price:0,image:"assets/11.jpg",action:"quote"},{id:15,name:"Dormitorio Principal",specs:"Cama, mesas de luz y respaldo",price:0,image:"assets/12.webp",action:"quote"},{id:16,name:"Espacio de Trabajo",specs:"Oficina en casa personalizada",price:0,image:"assets/13.webp",action:"quote"},{id:17,name:"Cocina Premium",specs:"Acabados de lujo",price:0,image:"assets/14.webp",action:"quote"},{id:18,name:"Estar Diario",specs:"Confort y diseño",price:0,image:"assets/15.webp",action:"quote"},{id:19,name:"Comedor Diario",specs:"Mobiliario integrado",price:0,image:"assets/16.webp",action:"quote"},{id:20,name:"Recibidor",specs:"Muebles de entrada",price:0,image:"assets/17.webp",action:"quote"},{id:21,name:"Living Integrado",specs:"Soluciones espaciales",price:0,image:"assets/18.webp",action:"quote"},{id:22,name:"Home Studio",specs:"Escritorios y bibliotecas",price:0,image:"assets/19.webp",action:"quote"}];let products=[...FALLBACK_STORE_PRODUCTS,...QUOTE_PRODUCTS];function buildCartProductMap(e){return e.filter(e=>"cart"===e.action).reduce((e,t)=>(e[t.id]=t,e),{})}let CART_PRODUCT_MAP=buildCartProductMap(products);const INITIAL_PRODUCTS_VISIBLE=12;let visibleProductsCount=12,activeCatalogFilter="all";const PRODUCT_IMAGE_SIZES="(max-width: 768px) 92vw, (max-width: 1200px) 45vw, 280px",PRODUCT_RESPONSIVE_VARIANTS={cabinet:[360,640,960],chair:[360,640,960],coffee_table:[360,640],desk_gamer:[360,640],library:[360,640],melamine_desk:[360,640,960],office_desk:[360,640],sideboard:[360,640],table:[360,640,960],tv_rack:[360,640],tv_unit:[360,640,960]},SHOP_PAGE_KEYS=new Set(["tienda","catalogo"]);function getCurrentPageKey(){const e=String(document.body?.dataset?.page||"").trim().toLowerCase();if(e)return e;return(String(window.location.pathname||"").toLowerCase().split("/").pop()||"index.html").replace(".html","")}function isShopPage(){return SHOP_PAGE_KEYS.has(getCurrentPageKey())}const DEFAULT_STORE_CONFIG=Object.freeze({acceptedPaymentMethods:["mercadopago","bank_transfer","cash_pickup"],stockMessage:"En stock - Envio en 48/72 hs",madeToOrderMessage:"Fabricacion bajo pedido - Entrega estimada: 10 a 20 dias habiles",warrantyMonths:12,coverage:"AMBA + interior del pais + retiro en taller"});let storeConfig={...DEFAULT_STORE_CONFIG};function normalizeStoreProductFromApi(e){const t=Number.parseInt(e?.id,10),a=Number.parseInt(e?.price,10),i=Math.max(0,Number.parseInt(e?.stock,10)||0),n="made_to_order"===String(e?.fulfillmentModel||"").toLowerCase()?"made_to_order":"stock",o=String(e?.availabilityMessage||"").trim()||("made_to_order"===n?storeConfig.madeToOrderMessage:storeConfig.stockMessage);return!Number.isInteger(t)||t<1||!Number.isInteger(a)||a<0?null:{id:t,name:String(e?.name||"").trim(),specs:String(e?.specs||"").trim(),price:a,image:String(e?.image||"").trim(),category:String(e?.category||"General").trim(),stock:i,fulfillmentModel:n,availabilityMessage:o,shippingEstimate:"made_to_order"===n?"10 a 20 dias habiles":"48/72 hs",weightKg:Number(e?.weightKg||0),volumeM3:Number(e?.volumeM3||0),action:"cart"}}async function loadStoreConfig(){try{const e=await fetch(buildApiUrl("/api/store/config"),{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)return;const t=await e.json();if(!t?.ok||!t?.tienda)return;const a=Array.isArray(t.tienda.acceptedPaymentMethods)?t.tienda.acceptedPaymentMethods.map(e=>String(e||"").trim().toLowerCase()).filter(Boolean):DEFAULT_STORE_CONFIG.acceptedPaymentMethods;storeConfig={acceptedPaymentMethods:a.length>0?a:DEFAULT_STORE_CONFIG.acceptedPaymentMethods,stockMessage:String(t.tienda.stockMessage||DEFAULT_STORE_CONFIG.stockMessage).trim(),madeToOrderMessage:String(t.tienda.madeToOrderMessage||DEFAULT_STORE_CONFIG.madeToOrderMessage).trim(),warrantyMonths:Number.parseInt(t.tienda.warrantyMonths,10)||DEFAULT_STORE_CONFIG.warrantyMonths,coverage:String(t.tienda.coverage||DEFAULT_STORE_CONFIG.coverage).trim()}}catch(e){storeConfig={...DEFAULT_STORE_CONFIG}}}async function loadStoreCatalog(){try{await loadStoreConfig();const e=await fetch(buildApiUrl("/api/store/catalog"),{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)return!1;const t=await e.json(),a=Array.isArray(t?.products)?t.products.map(normalizeStoreProductFromApi).filter(Boolean):[];return 0!==a.length&&(products=[...a,...QUOTE_PRODUCTS],CART_PRODUCT_MAP=buildCartProductMap(products),cart=sanitizeCart(cart),persistCart(cart),!0)}catch(e){return!1}}function getOptimizedImageBase(e){const t=String(e||"").split("/").pop().replace(/\.[a-z0-9]+$/i,"");return t?`assets/optimized/${t}`:""}function buildResponsiveProductPicture(e){const t=String(e.image||"").trim(),a=getOptimizedImageBase(t),i=String(t||"").split("/").pop().replace(/\.[a-z0-9]+$/i,""),n=PRODUCT_RESPONSIVE_VARIANTS[i];if(!t||!a)return`<img src="${t}" alt="${e.name}" loading="lazy" decoding="async" width="1024" height="1024">`;if(!Array.isArray(n)||0===n.length)return`<img src="${t}" alt="${e.name}" loading="lazy" decoding="async" width="1024" height="1024">`;const o=n.map(e=>`${a}-${e}.avif ${e}w`).join(", "),r=n.map(e=>`${a}-${e}.webp ${e}w`).join(", "),s=`${a}-${n[n.length-1]}.webp`;return`\n        <picture>\n            <source type="image/avif" srcset="${o}" sizes="${PRODUCT_IMAGE_SIZES}">\n            <source type="image/webp" srcset="${r}" sizes="${PRODUCT_IMAGE_SIZES}">\n            <img\n                src="${s}"\n                alt="${e.name}"\n                loading="lazy"\n                decoding="async"\n                width="1024"\n                height="1024"\n            >\n        </picture>\n    `}async function ensureRecaptchaScriptLoaded(){if(window.grecaptcha&&"function"==typeof window.grecaptcha.render&&"function"==typeof window.grecaptcha.getResponse)return window.grecaptcha;recaptchaScriptLoadPromise||(recaptchaScriptLoadPromise=new Promise((e,t)=>{const a=document.querySelector('script[data-recaptcha="v2"]');if(a)return a.addEventListener("load",()=>e(window.grecaptcha),{once:!0}),void a.addEventListener("error",()=>t(new Error("No pudimos cargar reCAPTCHA.")),{once:!0});const i=document.createElement("script");i.src=RECAPTCHA_V2_SCRIPT_URL,i.async=!0,i.defer=!0,i.dataset.recaptcha="v2",i.addEventListener("load",()=>e(window.grecaptcha),{once:!0}),i.addEventListener("error",()=>t(new Error("No pudimos cargar reCAPTCHA.")),{once:!0}),document.head.appendChild(i)}));const e=await recaptchaScriptLoadPromise;if(!e||"function"!=typeof e.render||"function"!=typeof e.getResponse)throw new Error("reCAPTCHA no está disponible en este navegador.");return e}async function ensureRecaptchaWidget(e){const t=document.getElementById(e);if(!t)return null;if(Number.isInteger(recaptchaWidgetIds[e]))return recaptchaWidgetIds[e];const a=(await ensureRecaptchaScriptLoaded()).render(t,{sitekey:RECAPTCHA_V2_SITE_KEY});return recaptchaWidgetIds[e]=a,a}function getRecaptchaToken(e){return window.grecaptcha&&Number.isInteger(e)?String(window.grecaptcha.getResponse(e)||"").trim():""}function resetRecaptchaWidget(e){window.grecaptcha&&Number.isInteger(e)&&window.grecaptcha.reset(e)}function setContactSubmitInfo(e,t="neutral"){const a=document.getElementById("contact-submit-info");a&&(a.textContent=e,a.classList.remove("is-success","is-error","is-loading"),"success"===t&&a.classList.add("is-success"),"error"===t&&a.classList.add("is-error"),"loading"===t&&a.classList.add("is-loading"))}function isValidEmailAddress(e){return/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(String(e||"").trim())}function setContactSubmittingState(e){const t=document.getElementById("contact-submit-btn");t&&(t.disabled=e,t.textContent=e?"Enviando…":"Solicitar Presupuesto")}function initContactFormSubmission(){const e=document.getElementById("form-contacto");if(!e)return;let t=null;ensureRecaptchaWidget("contact-recaptcha").then(e=>{t=e}).catch(e=>{setContactSubmitInfo(e.message||"No pudimos cargar reCAPTCHA.","error")});let a=!1;e.addEventListener("submit",async i=>{if(i.preventDefault(),a)return;const n=new FormData(e),o=String(n.get("email")||"").trim(),r=String(n.get("message")||"").trim();if(isValidEmailAddress(o))if(r.length<10)setContactSubmitInfo("El mensaje debe tener al menos 10 caracteres.","error");else{a=!0,setContactSubmittingState(!0),setContactSubmitInfo("Validando reCAPTCHA…","loading");try{Number.isInteger(t)||(t=await ensureRecaptchaWidget("contact-recaptcha"));const a=getRecaptchaToken(t);if(!a)return void setContactSubmitInfo("Completá el reCAPTCHA para continuar.","error");const i=Object.fromEntries(n.entries());i.recaptchaToken=a,setContactSubmitInfo("Enviando…","loading");const o=await fetch(buildApiUrl("/forms/contacto"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)});let r={};try{r=await o.json()}catch(e){r={}}if(o.ok&&!0===r.ok)return e.reset(),resetRecaptchaWidget(t),void setContactSubmitInfo("Mensaje enviado correctamente ✅","success");const s=String(r?.error||"").trim().toLowerCase();if("recaptcha_failed"===s)return resetRecaptchaWidget(t),void setContactSubmitInfo("No pudimos validar el reCAPTCHA. Intentá nuevamente.","error");if("recaptcha_not_configured"===s)return void setContactSubmitInfo("El formulario no está habilitado todavía. Falta configurar reCAPTCHA.","error");setContactSubmitInfo(String(r?.error||"").trim()||"Error al enviar. Intentá nuevamente.","error")}catch(e){setContactSubmitInfo(e.message||"Error al enviar. Intentá nuevamente.","error"),resetRecaptchaWidget(t)}finally{a=!1,setContactSubmittingState(!1)}}else setContactSubmitInfo("Ingresá un email válido.","error")})}const QUOTE_MAX_FILES_CLIENT=6,QUOTE_MAX_FILE_SIZE_BYTES_CLIENT=5242880,QUOTE_ALLOWED_MIME_TYPES_CLIENT=new Set(["image/jpeg","image/png","image/webp","application/pdf"]),DEFAULT_QUOTE_FILES_HELP="Podés adjuntar hasta 6 archivos (JPG, PNG, WEBP o PDF de hasta 5 MB cada uno).";let quoteSelectedFiles=[];function setQuoteSubmitInfo(e,t="neutral"){const a=document.getElementById("quote-submit-info");a&&(a.textContent=e,a.classList.remove("is-success","is-error","is-loading"),"success"===t&&a.classList.add("is-success"),"error"===t&&a.classList.add("is-error"),"loading"===t&&a.classList.add("is-loading"))}function setQuoteSubmittingState(e){const t=document.getElementById("quote-submit-btn");t&&(t.disabled=e,t.textContent=e?"Enviando...":"Enviar cotización")}function formatArPhoneMask(e){const t=String(e||"").replace(/\D/g,"").slice(0,13);if(!t)return"";let a=t;a.startsWith("54")&&(a=a.slice(2)),a.startsWith("9")&&(a=a.slice(1));const i=a.slice(0,2),n=a.slice(2,6),o=a.slice(6,10);let r="+54 9";return i&&(r+=` ${i}`),n&&(r+=` ${n}`),o&&(r+=`-${o}`),r.trim()}function bindPhoneInputMask(e){e&&(e.addEventListener("input",()=>{const t=e.selectionStart||0;e.value=formatArPhoneMask(e.value),e.setSelectionRange(e.value.length,e.value.length),0===t&&e.setSelectionRange(0,0)}),e.addEventListener("blur",()=>{e.value=formatArPhoneMask(e.value)}))}function initPhoneInputMasks(){document.querySelectorAll('input[data-inputmask="phone-ar"]').forEach(bindPhoneInputMask)}function validateQuoteFiles(e){const t=Array.from(e||[]);if(t.length>6)return"Podés adjuntar hasta 6 archivos.";for(const e of t){if(!QUOTE_ALLOWED_MIME_TYPES_CLIENT.has(String(e.type||"").toLowerCase()))return"Formato no permitido. Adjuntá JPG, PNG, WEBP o PDF.";if(Number(e.size||0)>5242880)return"Cada archivo puede pesar hasta 5 MB."}return""}function formatQuoteFileSize(e){const t=Number(e||0);return t>=1048576?`${(t/1048576).toFixed(1)} MB`:`${Math.max(1,Math.round(t/1024))} KB`}function setQuoteFilesFeedback(e="",t="neutral"){const a=document.getElementById("quote-files-feedback");a&&(a.textContent=e||DEFAULT_QUOTE_FILES_HELP,a.classList.remove("is-error","is-success"),"error"===t&&a.classList.add("is-error"),"success"===t&&a.classList.add("is-success"))}function renderQuoteSelectedFiles(){const e=document.getElementById("quote-files-selected");if(e){if(0===quoteSelectedFiles.length)return e.innerHTML="",void setQuoteFilesFeedback(DEFAULT_QUOTE_FILES_HELP,"neutral");e.innerHTML=quoteSelectedFiles.map((e,t)=>`\n        <div class="quote-files-selected-item">\n            <span>${e.name} (${formatQuoteFileSize(e.size)})</span>\n            <button type="button" class="quote-file-remove" data-index="${t}" aria-label="Quitar archivo">&times;</button>\n        </div>\n    `).join(""),e.querySelectorAll(".quote-file-remove").forEach(e=>{e.addEventListener("click",()=>{const t=Number.parseInt(e.dataset.index,10);!Number.isInteger(t)||t<0||t>=quoteSelectedFiles.length||(quoteSelectedFiles.splice(t,1),renderQuoteSelectedFiles())})}),setQuoteFilesFeedback(`Archivos seleccionados: ${quoteSelectedFiles.length}/6.`,"success")}}function isSameQuoteFile(e,t){return String(e?.name||"")===String(t?.name||"")&&Number(e?.size||0)===Number(t?.size||0)&&Number(e?.lastModified||0)===Number(t?.lastModified||0)}function mergeQuoteFiles(e){const t=Array.from(e||[]);if(0===t.length)return!0;const a=[...quoteSelectedFiles];for(const e of t){if(!e||"object"!=typeof e)continue;const t=String(e.type||"").toLowerCase();if(!QUOTE_ALLOWED_MIME_TYPES_CLIENT.has(t)){const t=`El archivo "${e.name}" no está permitido. Usá JPG, PNG, WEBP o PDF.`;return setQuoteFilesFeedback(t,"error"),setQuoteSubmitInfo(t,"error"),!1}if(Number(e.size||0)>5242880){const t=`El archivo "${e.name}" supera el límite de 5 MB.`;return setQuoteFilesFeedback(t,"error"),setQuoteSubmitInfo(t,"error"),!1}a.some(t=>isSameQuoteFile(t,e))||a.push(e)}if(a.length>6){const e="Podés adjuntar hasta 6 archivos.";return setQuoteFilesFeedback(e,"error"),setQuoteSubmitInfo(e,"error"),!1}return quoteSelectedFiles=a,renderQuoteSelectedFiles(),!0}function bindQuoteFilesUi(){const e=document.getElementById("quote-dropzone"),t=document.getElementById("quote-photos"),a=document.getElementById("quote-files-trigger");if(!e||!t||!a)return;const i=()=>{t.click()};a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),i()}),e.addEventListener("click",e=>{e.target!==a&&i()}),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i())}),t.addEventListener("change",()=>{mergeQuoteFiles(Array.from(t.files||[])),t.value=""}),["dragenter","dragover"].forEach(t=>{e.addEventListener(t,t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("is-dragging")})}),["dragleave","drop"].forEach(t=>{e.addEventListener(t,t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("is-dragging")})}),e.addEventListener("drop",e=>{mergeQuoteFiles(Array.from(e.dataTransfer?.files||[]))}),renderQuoteSelectedFiles()}function initQuoteFormSubmission(){const e=document.getElementById("form-medida");if(!e)return;quoteSelectedFiles=[],bindQuoteFilesUi();let t=null;ensureRecaptchaWidget("quote-recaptcha").then(e=>{t=e}).catch(e=>{setQuoteSubmitInfo(e.message||"No pudimos cargar reCAPTCHA.","error")});let a=!1;e.addEventListener("submit",async i=>{if(i.preventDefault(),a)return;const n=new FormData(e),o=String(n.get("fullName")||"").trim(),r=String(n.get("email")||"").trim(),s=String(n.get("phone")||"").trim(),l=String(n.get("cityNeighborhood")||"").trim(),c=String(n.get("province")||"").trim(),d=String(n.get("furnitureType")||"").trim(),u=String(n.get("approximateMeasures")||"").trim(),p=String(n.get("privacyAccepted")||"").trim(),m=validateQuoteFiles(quoteSelectedFiles);if(o.length<2)setQuoteSubmitInfo("Ingresá tu nombre completo.","error");else if(isValidEmailAddress(r))if(s.length<8)setQuoteSubmitInfo("Ingresá un teléfono válido.","error");else if(l.length<2)setQuoteSubmitInfo("Ingresá tu ciudad o barrio.","error");else if(c.length<2)setQuoteSubmitInfo("Ingresá tu provincia.","error");else if(d)if(u.length<5)setQuoteSubmitInfo("Completá las medidas aproximadas para cotizar.","error");else if(p){if(m)return setQuoteSubmitInfo(m,"error"),void setQuoteFilesFeedback(m,"error");a=!0,setQuoteSubmittingState(!0),setQuoteSubmitInfo("Validando reCAPTCHA...","loading");try{Number.isInteger(t)||(t=await ensureRecaptchaWidget("quote-recaptcha"));const a=getRecaptchaToken(t);if(!a)return void setQuoteSubmitInfo("Completá el reCAPTCHA para continuar.","error");const i=new FormData(e);i.delete("photos"),quoteSelectedFiles.forEach(e=>{i.append("photos",e,e.name)}),i.set("recaptchaToken",a),setQuoteSubmitInfo("Enviando solicitud de cotización...","loading");const n=await fetch(buildApiUrl("/forms/medida"),{method:"POST",headers:{Accept:"application/json"},body:i});let o={};try{o=await n.json()}catch(e){o={}}if(!n.ok||!1===o?.ok){const e=String(o?.error||"").trim().toLowerCase();if("recaptcha_failed"===e)throw new Error("No pudimos validar el reCAPTCHA. Intentá nuevamente.");if("recaptcha_not_configured"===e)throw new Error("El formulario no está habilitado todavía. Falta configurar reCAPTCHA.");throw new Error(o.error||"No pudimos enviar la solicitud de cotización.")}e.reset(),quoteSelectedFiles=[],renderQuoteSelectedFiles(),resetRecaptchaWidget(t),setQuoteSubmitInfo(o.message||"Solicitud enviada. Te vamos a contactar dentro de las próximas 24 horas hábiles.","success")}catch(e){setQuoteSubmitInfo(e.message||"No pudimos enviar la solicitud de cotización.","error"),resetRecaptchaWidget(t)}finally{a=!1,setQuoteSubmittingState(!1)}}else setQuoteSubmitInfo("Debés aceptar la Política de Privacidad.","error");else setQuoteSubmitInfo("Seleccioná el tipo de mueble.","error");else setQuoteSubmitInfo("Ingresá un email válido.","error")})}function sanitizeCart(e){return Array.isArray(e)?e.slice(0,20).map(e=>{const t=Number.parseInt(e?.id,10),a=Number.parseInt(e?.quantity,10),i=CART_PRODUCT_MAP[t];return!i||!Number.isInteger(a)||a<1||a>10?null:{id:t,name:i.name,price:i.price,image:i.image,quantity:a}}).filter(Boolean):[]}function loadStoredCart(){try{return sanitizeCart(JSON.parse(localStorage.getItem("zarpadoCart"))||[])}catch(e){return[]}}function persistCart(e){try{localStorage.setItem("zarpadoCart",JSON.stringify(e))}catch(e){}}function renderProducts(){const e=document.getElementById("products-grid");if(!e)return;const t=products.filter(e=>"cart"===e.action),a="all"===activeCatalogFilter?t:t.filter(e=>e.category===activeCatalogFilter),i=a.slice(0,visibleProductsCount),n=document.getElementById("catalogFilterResult");if(n){const e=1===a.length?"producto":"productos",t="all"===activeCatalogFilter?"todas las categorías":activeCatalogFilter;n.textContent=`Mostrando ${a.length} ${e} en ${t}.`}e.innerHTML=i.map((e,t)=>{const a=t%6*.1,i="made_to_order"===e.fulfillmentModel?"Fabricacion bajo pedido":`En stock - ${Number.parseInt(e.stock,10)||0} unidades`,n=String(e.availabilityMessage||e.shippingEstimate||"").trim();return`\n            <div class="product-card reveal" style="transition-delay: ${a}s;">\n                <div class="product-image">\n                    ${buildResponsiveProductPicture(e)}\n                </div>\n                <div class="product-details">\n                    <h4 class="product-name">${e.name}</h4>\n                    <p class="product-specs">${e.specs}</p>\n                    <p class="product-meta"><strong>Categoría:</strong> ${e.category}</p>\n                    <p class="product-meta"><strong>Disponibilidad:</strong> ${i}</p>\n                    <p class="product-meta"><strong>Logística:</strong> ${n}</p>\n                    <span class="product-price">$${e.price.toLocaleString("es-AR")}</span>\n                    <button class="btn-add-cart js-add-cart" data-product-id="${e.id}">Agregar al carrito</button>\n                </div>\n            </div>\n        `}).join(""),bindCatalogActions(e),renderLoadMoreButton(e,a.length),setTimeout(()=>{e.querySelectorAll(".reveal").forEach(observeRevealElement)},100)}function bindCatalogActions(e){e.querySelectorAll(".js-add-cart").forEach(e=>{e.addEventListener("click",()=>{addToCart(e.dataset.productId)})})}function renderLoadMoreButton(e,t){if(!e?.parentElement)return;const a=document.getElementById("catalog-load-more");if(a&&a.remove(),visibleProductsCount>=t)return;const i=document.createElement("div");i.id="catalog-load-more",i.className="catalog-load-more",i.innerHTML='<button type="button" id="loadMoreProductsBtn" class="btn btn-outline">Ver mas productos</button>',e.parentElement.appendChild(i);const n=document.getElementById("loadMoreProductsBtn");n?.addEventListener("click",()=>{visibleProductsCount=Math.min(visibleProductsCount+8,t),renderProducts()})}function initCatalogFilters(){const e=document.querySelectorAll(".js-catalog-filter");if(0===e.length)return;const t=new URLSearchParams(window.location.search),a=String(t.get("categoria")||"").trim();if(a){const t=a.toLowerCase(),i=Array.from(e).find(e=>String(e.dataset.filter||"").toLowerCase()===t);i&&(activeCatalogFilter=String(i.dataset.filter))}e.forEach(t=>{t.addEventListener("click",()=>{const a=String(t.dataset.filter||"all");activeCatalogFilter=a,visibleProductsCount=12,e.forEach(e=>{const t=e.dataset.filter===a;e.classList.toggle("active",t),e.setAttribute("aria-pressed",String(t))}),renderProducts()})}),e.forEach(e=>{const t=e.dataset.filter===activeCatalogFilter;e.classList.toggle("active",t),e.setAttribute("aria-pressed",String(t))})}function bindStaticAddToCartButtons(){document.querySelectorAll(".js-static-add-to-cart").forEach(e=>{e.addEventListener("click",()=>{addToCart(e.dataset.productId)})})}function bindCommonUiActions(){document.querySelectorAll(".js-toggle-cart").forEach(e=>{e.addEventListener("click",toggleCart)}),document.querySelectorAll(".js-checkout").forEach(e=>{e.addEventListener("click",checkout)}),document.querySelectorAll(".js-close-notification").forEach(e=>{e.addEventListener("click",closeNotification)}),document.querySelectorAll(".js-feature-link").forEach(e=>{const t=e.dataset.href;t&&(e.setAttribute("role","link"),e.setAttribute("tabindex","0"),e.addEventListener("click",()=>{window.location.href=t}),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.location.href=t)}))})}function injectDeliveryPolicyPanel(){const e=String(document.body?.dataset?.page||"").trim().toLowerCase(),t=String(window.location.pathname||"").toLowerCase();if(!("tienda"===e||"amedida"===e||"/tienda"===t||t.startsWith("/tienda/")||"/a-medida"===t||t.endsWith("/tienda.html")||t.endsWith("/a-medida.html")||t.endsWith("/catalogo.html")))return;if(document.getElementById("delivery-policy-panel"))return;const a=document.querySelector(".footer");if(!a)return;const i=document.createElement("section");i.className="section delivery-policy-section",i.id="delivery-policy-panel",i.innerHTML='\n        <div class="container">\n            <div class="delivery-policy-panel reveal">\n                <span class="section-tag">Logística</span>\n                <h2 class="section-title">Envíos, instalación y retiro</h2>\n                <ul class="delivery-policy-list">\n                    <li>Envíos a todo el país a la dirección brindada por el cliente.</li>\n                    <li>Instalación solo en Buenos Aires y sujeta a disponibilidad de zona (consultar por CP).</li>\n                    <li>Retiro por fábrica: Salto 850, Francisco Álvarez, Moreno, Buenos Aires (con flete propio).</li>\n                    <li>Instalación base desde $200.000 (traslado + colocación simple). Trabajos complejos se cotizan aparte.</li>\n                </ul>\n            </div>\n        </div>\n    ',a.parentNode.insertBefore(i,a),i.querySelectorAll(".reveal").forEach(observeRevealElement)}function formatArs(e){return`$${Number(e||0).toLocaleString("es-AR")}`}const DELIVERY_METHOD_SHIPPING="shipping",DELIVERY_METHOD_PICKUP="pickup",PAYMENT_METHOD_MERCADOPAGO="mercadopago",PAYMENT_METHOD_BANK_TRANSFER="bank_transfer",PAYMENT_METHOD_CASH_PICKUP="cash_pickup",PAYMENT_METHOD_LABELS=Object.freeze({[PAYMENT_METHOD_MERCADOPAGO]:"Mercado Pago",[PAYMENT_METHOD_BANK_TRANSFER]:"Transferencia bancaria",[PAYMENT_METHOD_CASH_PICKUP]:"Efectivo en retiro"}),DEFAULT_DELIVERY_CONFIG=Object.freeze({installationBaseCost:2e5,installationComplexNotice:"Instalaciones complejas se cotizan aparte.",unsupportedPostalCodeMessage:"No podemos calcular el envío automáticamente para tu CP. Contactanos para cotización.",factoryPickupAddress:"Salto 850, Francisco Álvarez, Moreno, Buenos Aires",factoryPickupNote:"Retiro sin costo. El cliente debe venir con su flete propio. Se entrega el mueble en fábrica.",installationZoneLabel:"Buenos Aires (zonas seleccionadas)"});let cart=loadStoredCart();const cartItemsContainer=document.getElementById("cartItems"),cartTotalElement=document.getElementById("cartTotal"),cartCountElement=document.querySelector(".cart-count");let deliveryConfig={...DEFAULT_DELIVERY_CONFIG},shippingQuoteDebounceId=null,lastShippingQuoteKey="",shippingQuoteRequestSequence=0,deliveryPanelOpen=!1;const deliveryState={method:"shipping",postalCode:"",shippingCost:0,shippingLabel:"",shippingReady:!1,shippingLoading:!1,shippingError:"",installationAvailable:!1,installationSelected:!1,paymentMethod:"mercadopago",buyerEmail:""};function buildShippingQuoteKey(e=deliveryState.postalCode){return`${String(e||"").trim()}::${cart.map(e=>`${Number.parseInt(e.id,10)}:${Number.parseInt(e.quantity,10)}`).filter(Boolean).sort().join("|")}`}function getDeliveryInputRefs(){return{methodInputs:document.querySelectorAll('input[name="delivery-method"]'),postalCodeInput:document.getElementById("delivery-postal-code"),shippingControls:document.getElementById("delivery-shipping-controls"),pickupInfo:document.getElementById("delivery-pickup-info"),quoteMessage:document.getElementById("delivery-quote-message"),installationWrap:document.getElementById("delivery-installation-wrap"),installationCheckbox:document.getElementById("delivery-installation"),installationUnavailable:document.getElementById("delivery-installation-unavailable"),installationLabel:document.getElementById("delivery-installation-label"),installationNote:document.getElementById("delivery-installation-note"),compactSummary:document.getElementById("delivery-compact-summary"),configPanel:document.getElementById("delivery-config-panel"),configToggle:document.getElementById("delivery-config-toggle"),checkoutMessage:document.getElementById("delivery-checkout-message"),paymentMethodSelect:document.getElementById("delivery-payment-method"),buyerEmailInput:document.getElementById("delivery-buyer-email"),paymentMethodNote:document.getElementById("delivery-payment-note"),subtotalValue:document.getElementById("cartSubtotal"),shippingValue:document.getElementById("cartShippingValue"),installationRow:document.getElementById("cartInstallationRow"),installationValue:document.getElementById("cartInstallationValue")}}function getCostBreakdown(){const e=cart.reduce((e,t)=>e+t.price*t.quantity,0),t="pickup"===deliveryState.method?0:deliveryState.shippingReady?deliveryState.shippingCost:0,a="shipping"===deliveryState.method&&deliveryState.installationSelected&&deliveryState.installationAvailable?deliveryConfig.installationBaseCost:0;return{subtotal:e,shipping:t,installation:a,total:e+t+a}}function getDeliveryCompactSummary(){if("pickup"===deliveryState.method)return"Retiro por fábrica (sin costo de envío).";if(deliveryState.shippingLoading)return"Envío a domicilio · calculando costo...";if(deliveryState.shippingReady){const e=deliveryState.installationSelected&&deliveryState.installationAvailable?` + instalación ${formatArs(deliveryConfig.installationBaseCost)}`:"";return`Envío ${deliveryState.shippingLabel}: ${formatArs(deliveryState.shippingCost)}${e}`}return deliveryState.shippingError?deliveryState.shippingError:"Completá el CP para calcular el envío."}function setDeliveryPanelOpen(e){const t=Boolean(e);deliveryPanelOpen=t;const a=getDeliveryInputRefs();a.configPanel&&(a.configPanel.hidden=!t),a.configToggle&&(a.configToggle.setAttribute("aria-expanded",t?"true":"false"),a.configToggle.textContent=t?"Ocultar":"Configurar");const i=document.getElementById("delivery-checkout-box");i&&i.classList.toggle("is-expanded",t)}function getCheckoutValidation(){return 0===cart.length?{ok:!1,message:"El carrito está vacío. Agregá al menos un producto para continuar."}:"pickup"===deliveryState.method?{ok:!0,message:""}:deliveryState.shippingLoading?{ok:!1,message:"Estamos calculando tu envío. Esperá unos segundos."}:deliveryState.postalCode.length<4?{ok:!1,message:"Ingresá el código postal o elegí retiro por fábrica para continuar."}:deliveryState.shippingError?{ok:!1,message:deliveryState.shippingError}:deliveryState.shippingReady?{ok:!0,message:""}:{ok:!1,message:"Necesitamos validar el envío antes de continuar."}}function updateCheckoutButtonsState(){const e=getCheckoutValidation(),t=getDeliveryInputRefs();document.querySelectorAll(".js-checkout").forEach(t=>{t.disabled=!e.ok}),t.checkoutMessage&&(t.checkoutMessage.textContent=e.message,t.checkoutMessage.classList.toggle("is-error",!e.ok&&e.message.length>0))}function updateTotalsUi(){const e=getCostBreakdown(),t=getDeliveryInputRefs();if(t.subtotalValue&&(t.subtotalValue.textContent=formatArs(e.subtotal)),t.shippingValue&&("pickup"===deliveryState.method?t.shippingValue.textContent=formatArs(0):deliveryState.shippingLoading?t.shippingValue.textContent="Calculando...":deliveryState.shippingReady?t.shippingValue.textContent=formatArs(e.shipping):deliveryState.postalCode.length<4?t.shippingValue.textContent="Ingresá CP":t.shippingValue.textContent="A cotizar"),t.installationRow&&t.installationValue){const a=e.installation>0;t.installationRow.hidden=!a,t.installationValue.textContent=formatArs(e.installation)}cartTotalElement&&(cartTotalElement.textContent=formatArs(e.total)),updateCheckoutButtonsState()}function updateDeliveryUi(){const e=getDeliveryInputRefs();if(e.shippingControls&&(e.shippingControls.hidden="shipping"!==deliveryState.method),e.pickupInfo&&(e.pickupInfo.hidden="pickup"!==deliveryState.method,e.pickupInfo.textContent=`${deliveryConfig.factoryPickupAddress}. ${deliveryConfig.factoryPickupNote}`),e.postalCodeInput&&e.postalCodeInput.value!==deliveryState.postalCode&&(e.postalCodeInput.value=deliveryState.postalCode),e.paymentMethodSelect){const t=Array.isArray(storeConfig.acceptedPaymentMethods)?storeConfig.acceptedPaymentMethods:DEFAULT_STORE_CONFIG.acceptedPaymentMethods;Array.from(e.paymentMethodSelect.options).forEach(e=>{const a=t.includes(e.value);e.hidden=!a,e.disabled=!a}),t.includes(deliveryState.paymentMethod)||(deliveryState.paymentMethod=t[0]||"mercadopago"),e.paymentMethodSelect.value!==deliveryState.paymentMethod&&(e.paymentMethodSelect.value=deliveryState.paymentMethod)}if(e.buyerEmailInput&&e.buyerEmailInput.value!==deliveryState.buyerEmail&&(e.buyerEmailInput.value=deliveryState.buyerEmail),e.paymentMethodNote){const t=PAYMENT_METHOD_LABELS[deliveryState.paymentMethod]||"Medio de pago";"bank_transfer"===deliveryState.paymentMethod?e.paymentMethodNote.textContent=`${t}: el pedido queda pendiente hasta confirmar acreditación.`:"cash_pickup"===deliveryState.paymentMethod?e.paymentMethodNote.textContent=`${t}: disponible solo para retiro en taller.`:e.paymentMethodNote.textContent=`${t}: confirmación automática al acreditarse el pago.`}if(e.installationWrap){const t="shipping"===deliveryState.method&&deliveryState.shippingReady&&deliveryState.installationAvailable;e.installationWrap.hidden=!t}if(e.installationCheckbox&&(e.installationCheckbox.checked=deliveryState.installationSelected),e.installationLabel&&(e.installationLabel.textContent=`Agregar instalación (${formatArs(deliveryConfig.installationBaseCost)} base)`),e.installationNote&&(e.installationNote.textContent=`${deliveryConfig.installationZoneLabel}. ${deliveryConfig.installationComplexNotice}`),e.installationUnavailable){const t="shipping"===deliveryState.method&&deliveryState.shippingReady&&!deliveryState.installationAvailable;e.installationUnavailable.hidden=!t,e.installationUnavailable.textContent=t?"Instalación no disponible en tu zona. Podés continuar con envío sin instalación o retiro por fábrica.":""}e.compactSummary&&(e.compactSummary.textContent=getDeliveryCompactSummary(),e.compactSummary.classList.toggle("is-error",Boolean(deliveryState.shippingError))),e.quoteMessage&&("pickup"===deliveryState.method?(e.quoteMessage.textContent="Retiro por fábrica sin costo de envío.",e.quoteMessage.classList.remove("is-error")):deliveryState.shippingLoading?(e.quoteMessage.textContent="Calculando costo de envío...",e.quoteMessage.classList.remove("is-error")):deliveryState.shippingReady?(e.quoteMessage.textContent=`Envío ${deliveryState.shippingLabel}: ${formatArs(deliveryState.shippingCost)}`,e.quoteMessage.classList.remove("is-error")):deliveryState.shippingError?(e.quoteMessage.textContent=deliveryState.shippingError,e.quoteMessage.classList.add("is-error")):(e.quoteMessage.textContent="Ingresá tu código postal para calcular el envío.",e.quoteMessage.classList.remove("is-error"))),e.methodInputs.forEach(e=>{e.checked=e.value===deliveryState.method}),updateTotalsUi();const t=buildShippingQuoteKey();!("shipping"!==deliveryState.method||4!==deliveryState.postalCode.length||deliveryState.shippingLoading||deliveryState.shippingError||deliveryState.shippingReady&&lastShippingQuoteKey===t)&&(shippingQuoteDebounceId&&clearTimeout(shippingQuoteDebounceId),shippingQuoteDebounceId=setTimeout(()=>{shippingQuoteDebounceId=null,requestShippingQuote(deliveryState.postalCode)},250))}function resetShippingState(){deliveryState.shippingCost=0,deliveryState.shippingLabel="",deliveryState.shippingReady=!1,deliveryState.shippingLoading=!1,deliveryState.shippingError="",deliveryState.installationAvailable=!1,deliveryState.installationSelected=!1,lastShippingQuoteKey=""}async function loadDeliveryOptions(){try{const e=await fetch(buildApiUrl("/api/delivery/options"),{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)return;const t=await e.json();deliveryConfig={installationBaseCost:Number.parseInt(t.installationBaseCost,10)||DEFAULT_DELIVERY_CONFIG.installationBaseCost,installationComplexNotice:String(t.installationComplexNotice||DEFAULT_DELIVERY_CONFIG.installationComplexNotice),unsupportedPostalCodeMessage:String(t.unsupportedPostalCodeMessage||DEFAULT_DELIVERY_CONFIG.unsupportedPostalCodeMessage),factoryPickupAddress:String(t.factoryPickup?.address||DEFAULT_DELIVERY_CONFIG.factoryPickupAddress),factoryPickupNote:String(t.factoryPickup?.note||DEFAULT_DELIVERY_CONFIG.factoryPickupNote),installationZoneLabel:String(t.installationZonesLabel||DEFAULT_DELIVERY_CONFIG.installationZoneLabel)}}catch(e){deliveryConfig={...DEFAULT_DELIVERY_CONFIG}}updateDeliveryUi()}async function requestShippingQuote(e){const t=buildShippingQuoteKey(String(e||"").trim()),a=++shippingQuoteRequestSequence;deliveryState.shippingLoading=!0,deliveryState.shippingError="",deliveryState.shippingReady=!1,deliveryState.installationSelected=!1,updateDeliveryUi();try{const i=cart.map(e=>({id:e.id,quantity:e.quantity})),n=await fetch(buildApiUrl("/api/delivery/quote"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({postalCode:e,items:i})}),o=await n.json();if(a!==shippingQuoteRequestSequence)return;if(!n.ok)return deliveryState.shippingError=String(o.error||deliveryConfig.unsupportedPostalCodeMessage),deliveryState.shippingCost=0,deliveryState.shippingLabel="",deliveryState.shippingReady=!1,void(deliveryState.installationAvailable=!1);deliveryState.shippingCost=Number.parseInt(o.shippingCost,10)||0,deliveryState.shippingLabel=String(o.shippingLabel||"Envío a domicilio"),deliveryState.shippingReady=!0,deliveryState.shippingError="",deliveryState.installationAvailable=Boolean(o.installationAvailable),lastShippingQuoteKey=t,deliveryConfig.installationBaseCost=Number.parseInt(o.installationBaseCost,10)||deliveryConfig.installationBaseCost,deliveryConfig.installationComplexNotice=String(o.installationComplexNotice||deliveryConfig.installationComplexNotice)}catch(e){if(a!==shippingQuoteRequestSequence)return;deliveryState.shippingError="No pudimos calcular el envío en este momento. Intentá nuevamente.",deliveryState.shippingReady=!1}finally{if(a!==shippingQuoteRequestSequence)return;deliveryState.shippingLoading=!1,updateDeliveryUi()}}function bindDeliveryUiActions(){const e=getDeliveryInputRefs();e.configToggle?.addEventListener("click",()=>{setDeliveryPanelOpen(!deliveryPanelOpen)}),e.methodInputs.forEach(e=>{e.addEventListener("change",()=>{if(deliveryState.method=e.value,"shipping"===deliveryState.method&&"cash_pickup"===deliveryState.paymentMethod){const e=Array.isArray(storeConfig.acceptedPaymentMethods)?storeConfig.acceptedPaymentMethods:DEFAULT_STORE_CONFIG.acceptedPaymentMethods;deliveryState.paymentMethod=e.includes("mercadopago")?"mercadopago":e[0]||"mercadopago"}if("pickup"===deliveryState.method)return resetShippingState(),void updateDeliveryUi();resetShippingState(),4===deliveryState.postalCode.length?requestShippingQuote(deliveryState.postalCode):updateDeliveryUi()})}),e.postalCodeInput?.addEventListener("input",()=>{const t=e.postalCodeInput.value.replace(/\D/g,"").slice(0,4);e.postalCodeInput.value=t,deliveryState.postalCode=t,resetShippingState(),shippingQuoteDebounceId&&(clearTimeout(shippingQuoteDebounceId),shippingQuoteDebounceId=null),t.length<4?updateDeliveryUi():shippingQuoteDebounceId=setTimeout(()=>{shippingQuoteDebounceId=null,requestShippingQuote(t)},350)}),e.installationCheckbox?.addEventListener("change",()=>{deliveryState.installationSelected=e.installationCheckbox.checked,updateDeliveryUi()}),e.paymentMethodSelect?.addEventListener("change",()=>{const t=String(e.paymentMethodSelect.value||"mercadopago"),a=Array.isArray(storeConfig.acceptedPaymentMethods)?storeConfig.acceptedPaymentMethods:DEFAULT_STORE_CONFIG.acceptedPaymentMethods;deliveryState.paymentMethod=a.includes(t)?t:"mercadopago","cash_pickup"===deliveryState.paymentMethod&&"pickup"!==deliveryState.method&&(deliveryState.method="pickup",resetShippingState()),updateDeliveryUi()}),e.buyerEmailInput?.addEventListener("input",()=>{deliveryState.buyerEmail=String(e.buyerEmailInput.value||"").trim(),updateCheckoutButtonsState()})}function ensureDeliveryCheckoutUi(){const e=document.querySelector(".cart-footer");if(!e||document.getElementById("delivery-checkout-box"))return;const t=document.createElement("div");t.id="delivery-checkout-box",t.className="delivery-checkout-box",t.innerHTML=`\n        <h4 class="delivery-checkout-title">Entrega</h4>\n        <div class="delivery-checkout-head">\n            <p id="delivery-compact-summary" class="delivery-compact-summary">Completá el CP para calcular el envío.</p>\n            <button\n                id="delivery-config-toggle"\n                class="delivery-config-toggle"\n                type="button"\n                aria-expanded="false"\n                aria-controls="delivery-config-panel"\n            >\n                Configurar\n            </button>\n        </div>\n        <div id="delivery-config-panel" class="delivery-config-panel" hidden>\n            <div class="delivery-methods">\n                <label class="delivery-option">\n                    <input type="radio" name="delivery-method" value="shipping" checked>\n                    <span>Envío a domicilio</span>\n                </label>\n                <label class="delivery-option">\n                    <input type="radio" name="delivery-method" value="pickup">\n                    <span>Retiro por fábrica</span>\n                </label>\n            </div>\n            <div id="delivery-shipping-controls" class="delivery-shipping-controls">\n                <label for="delivery-postal-code">Código Postal</label>\n                <input id="delivery-postal-code" type="text" inputmode="numeric" autocomplete="postal-code" placeholder="Ej: 1746" maxlength="4">\n                <p id="delivery-quote-message" class="delivery-help-message">Ingresá tu código postal para calcular el envío.</p>\n            </div>\n            <p id="delivery-pickup-info" class="delivery-help-message" hidden></p>\n            <div id="delivery-installation-wrap" class="delivery-installation-wrap" hidden>\n                <label class="delivery-option">\n                    <input id="delivery-installation" type="checkbox">\n                    <span id="delivery-installation-label"></span>\n                </label>\n                <p id="delivery-installation-note" class="delivery-help-message"></p>\n            </div>\n            <p id="delivery-installation-unavailable" class="delivery-help-message is-error" hidden></p>\n            <div class="delivery-payment-box">\n                <label for="delivery-payment-method">Medio de pago</label>\n                <select id="delivery-payment-method" class="form-input">\n                    <option value="mercadopago">Mercado Pago</option>\n                    <option value="bank_transfer">Transferencia bancaria</option>\n                    <option value="cash_pickup">Efectivo en retiro</option>\n                </select>\n                <label for="delivery-buyer-email" style="margin-top: 0.65rem;">Email para confirmaciones</label>\n                <input id="delivery-buyer-email" class="form-input" type="email" inputmode="email" autocomplete="email" placeholder="tuemail@dominio.com">\n                <p id="delivery-payment-note" class="delivery-help-message"></p>\n            </div>\n            <div class="cart-breakdown" id="cart-breakdown">\n                <div class="cart-breakdown-row">\n                    <span>Subtotal</span>\n                    <span id="cartSubtotal">${formatArs(0)}</span>\n                </div>\n                <div class="cart-breakdown-row">\n                    <span>Envío</span>\n                    <span id="cartShippingValue">Ingresá CP</span>\n                </div>\n                <div class="cart-breakdown-row" id="cartInstallationRow" hidden>\n                    <span>Instalación (base)</span>\n                    <span id="cartInstallationValue">${formatArs(0)}</span>\n                </div>\n            </div>\n        </div>\n        <p id="delivery-checkout-message" class="delivery-help-message is-error"></p>\n    `;const a=e.querySelector(".cart-total-row");if(a){const i=a.querySelector("span");i&&(i.textContent="Total final:"),e.insertBefore(t,a)}else e.prepend(t);bindDeliveryUiActions(),setDeliveryPanelOpen(!1),updateDeliveryUi()}function buildDeliveryPayload(){return"pickup"===deliveryState.method?{method:"pickup",postalCode:null,installationRequested:!1}:{method:"shipping",postalCode:deliveryState.postalCode,installationRequested:deliveryState.installationSelected}}function toggleCart(){if(!cartSidebar)return;const e=!cartSidebar.classList.contains("open");e&&closeMobileMenu(),setCartOpenState(e)}function addToCart(e){const t=CART_PRODUCT_MAP[Number.parseInt(e,10)];if(!t)return;const a=cart.find(e=>e.id===t.id);a?a.quantity=Math.min(a.quantity+1,10):cart.push({id:t.id,name:t.name,price:t.price,image:t.image,quantity:1}),updateCart(),showAddedNotification(t.name)}function showAddedNotification(e){let t=document.getElementById("added-notification");t||(t=document.createElement("div"),t.id="added-notification",t.className="added-notification",t.innerHTML='\n            <i class="fas fa-check-circle"></i>\n            <p></p>\n        ',document.body.appendChild(t));t.querySelector("p").textContent=`Agregaste ${e} al carrito`,setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show")},3500)}function removeFromCart(e){const t=Number.parseInt(e,10);cart=cart.filter(e=>e.id!==t),updateCart()}function updateQuantity(e,t){const a=Number.parseInt(e,10),i=cart.find(e=>e.id===a);i&&(i.quantity+=t,i.quantity<=0?removeFromCart(a):i.quantity>10?(i.quantity=10,updateCart()):updateCart())}function updateCart(){const e=Boolean(cartSidebar?.classList.contains("open"));cart=sanitizeCart(cart),persistCart(cart);const t=cart.reduce((e,t)=>e+t.quantity,0);cartCountElement&&(cartCountElement.textContent=t),cartItemsContainer&&(cartItemsContainer.innerHTML="",0===cart.length?cartItemsContainer.innerHTML='<p style="text-align:center; color: #888; margin-top: 2rem;">El carrito está vacío.</p>':cart.forEach(e=>{const t=document.createElement("div");t.classList.add("cart-item"),t.innerHTML=`\n                    <img src="${e.image}" alt="${e.name}">\n                    <div style="flex:1;">\n                        <h4 style="font-size: 0.9rem; margin-bottom: 4px;">${e.name}</h4>\n                        <p style="color: var(--color-accent); font-size: 0.85rem;">${formatArs(e.price)}</p>\n                        <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">\n                            <button type="button" data-action="decrease" data-product-id="${e.id}" style="width: 20px; height: 20px; background:#333; color:#fff; border:none; cursor:pointer;">-</button>\n                            <span style="font-size: 0.9rem;">${e.quantity}</span>\n                            <button type="button" data-action="increase" data-product-id="${e.id}" style="width: 20px; height: 20px; background:#333; color:#fff; border:none; cursor:pointer;">+</button>\n                        </div>\n                    </div>\n                    <button type="button" data-action="remove" data-product-id="${e.id}" style="background:none; border:none; color: #888; cursor:pointer; font-size: 1.2rem;">&times;</button>\n                `,t.querySelector('[data-action="decrease"]')?.addEventListener("click",()=>{updateQuantity(e.id,-1)}),t.querySelector('[data-action="increase"]')?.addEventListener("click",()=>{updateQuantity(e.id,1)}),t.querySelector('[data-action="remove"]')?.addEventListener("click",()=>{removeFromCart(e.id)}),cartItemsContainer.appendChild(t)})),updateTotalsUi(),"shipping"!==deliveryState.method||4!==deliveryState.postalCode.length||deliveryState.shippingLoading||updateDeliveryUi(),e&&setCartOpenState(!0)}async function checkout(e=null){const t=getCheckoutValidation();if(!t.ok)return void alert(t.message||"Revisá los datos de entrega antes de continuar.");let a=null,i="";try{if(cart=sanitizeCart(cart),0===cart.length)return void alert("El carrito está vacío");const t=e||("undefined"!=typeof event?event:null);a=t?.target||document.querySelector(".cart-footer .btn.btn-primary"),i=a?.textContent||"",a&&(a.disabled=!0,a.textContent="Procesando..."),window.location.href="/datos-envio"}catch(e){console.error("Error en checkout:",e),alert(e.message||"No pudimos continuar con el checkout."),a&&(a.disabled=!1,a.textContent=i)}}function initHeroSlideshow(){const e=Array.from(document.querySelectorAll(".hero-slide"));if(0===e.length)return;const t=window.matchMedia("(orientation: portrait)");let a=[],i=0,n=null,o="",r=null;const s=(e,t)=>{const a=((e,t)=>{const a=String(e.dataset.bgDesktop||"").trim(),i=String(e.dataset.bgMobile||"").trim(),n=String(e.dataset.bg||"").trim();return t?i||n||a:a||n})(e,t);return e.classList.remove("active"),a?(e.hidden=!1,e.style.backgroundImage=`url('${a}')`,!0):(e.hidden=!0,e.style.backgroundImage="",!1)},l=()=>{n&&(clearInterval(n),n=null),a.length<2||(n=setInterval(()=>{a[i].classList.remove("active"),i=(i+1)%a.length,a[i].classList.add("active")},3e3))},c=()=>{const t=(()=>{const e=window.innerWidth||document.documentElement.clientWidth||0,t=window.innerHeight||document.documentElement.clientHeight||0;return e<=900&&t>e})(),n=t?"mobile":"desktop";(n!==o||0===a.length)&&(o=n,a=e.filter(e=>s(e,t)),0!==a.length&&(i=0,a[0].classList.add("active"),l()))};c(),window.addEventListener("resize",()=>{r&&clearTimeout(r),r=setTimeout(()=>{r=null,c()},120)},{passive:!0}),t.addEventListener?t.addEventListener("change",c):t.addListener&&t.addListener(c)}function closeNotification(){const e=document.getElementById("cart-notification");e&&e.classList.remove("show")}function openQuoteById(e){const t=Number.parseInt(e,10),a=products.find(e=>e.id===t);a&&openQuote(a.name)}function openQuote(e){const t=String(e||"").slice(0,120);window.location.href=`/contacto?producto=${encodeURIComponent(t)}`}document.addEventListener("DOMContentLoaded",async()=>{initThemeToggle(),syncUiOverlayState(),initPhoneInputMasks(),await loadStoreCatalog(),initCatalogFilters(),renderProducts(),bindCommonUiActions(),bindStaticAddToCartButtons(),setupAccessibleTriggers(),ensureDeliveryCheckoutUi(),updateCart(),await loadDeliveryOptions(),updateDeliveryUi(),injectDeliveryPolicyPanel(),initContactFormSubmission(),initQuoteFormSubmission();if(String(window.location.pathname||"").toLowerCase().includes("contacto")){const e=new URLSearchParams(window.location.search),t=String(e.get("producto")||"").slice(0,120);if(setContactSubmitInfo("Responderemos a la brevedad posible."),t){const e=document.querySelector('select[name="type"]'),a=document.querySelector('textarea[name="message"]'),i=document.querySelector('input[name="productReference"]');if(i&&(i.value=t),e){const a=t.toLowerCase();a.includes("cocina")?e.value="Cocina":a.includes("placard")||a.includes("vestidor")?e.value="Placard":a.includes("rack")||a.includes("tv")||a.includes("vajillero")?e.value="Rack TV":a.includes("escritorio")||a.includes("oficina")?e.value="Escritorio":e.value="Otro"}a&&(a.value=`Hola, buenas tardes. Me comunico para consultar el precio para realizar "${t}" a medida.`)}}cart.length>0&&setTimeout(()=>{const e=document.getElementById("cart-notification");e&&e.classList.add("show")},1e4),initHeroSlideshow()});